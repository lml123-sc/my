{"version":3,"sources":["/src/load-js.js"],"names":["createLoadJS","cache","head","document","getElementsByTagName","documentElement","exec","options","url","debug","cacheId","id","cacheEntry","console","log","allowExternal","el","script","getElementById","loadJS","warn","getScriptById","querySelector","getScriptByUrl","promise","Promise","resolve","text","Error","pending","reject","done","onload","onreadystatechange","readyState","onerror","appendChild","createElement","charset","type","async","src","createScript","items","Array","all","map","module","exports","create"],"mappings":";s3BAAA,SAASA,IACP,IAAIC,KACAC,EAAOC,SAASC,qBAAqB,QAAQ,IAAMD,SAASE,gBAEhE,SAASC,EAAKC,GACW,iBAAZA,IACTA,GACEC,IAAKD,EACLE,OAAO,IAIX,IAAIC,EAAUH,EAAQI,IAAMJ,EAAQC,IAChCI,EAAaX,EAAMS,GAEvB,GAAIE,EAIF,OAHML,EAAQE,OACZI,QAAQC,IAAI,qBAAsBJ,GAE7BE,EAEJ,IAA8B,IAA1BL,EAAQQ,cAAyB,CACxC,IAAIC,EA8ER,SAAuBL,GACrB,IAAIM,EAASN,GAAMR,SAASe,eAAeP,GAE3C,GAAIM,GAA4B,cAAlBA,EAAOE,OAEnB,OADAN,QAAQO,KAAK,qCAAsCT,GAC5CM,EAnFEI,CAAcd,EAAQI,KAuFnC,SAAwBH,GACtB,IAAIS,EAAST,GAAOL,SAASmB,cAAc,eAAiBd,EAAM,MAElE,GAAIS,GAA4B,cAAlBA,EAAOE,OAEnB,OADAN,QAAQO,KAAK,sCAAuCZ,GAC7CS,EA5F+BM,CAAehB,EAAQC,KAE7D,GAAIQ,EAAI,CACN,IAAIQ,EAAUC,QAAQC,QAAQV,GAM9B,OAJIN,IACFT,EAAMS,GAAWc,GAGZA,GAIX,IAAKjB,EAAQC,MAAQD,EAAQoB,KAC3B,MAAM,IAAIC,MAAM,+CAGlB,IAAIC,GAAWtB,EAAQC,IAczB,SAAoBN,EAAMe,GACxB,OAAO,IAAIQ,QAAQ,SAASC,EAASI,GAEnC,IAAIC,GAAO,EASXd,EAAOe,OAASf,EAAOgB,mBAAqB,WACrCF,GAAUd,EAAOiB,YAAoC,WAAtBjB,EAAOiB,YAAiD,aAAtBjB,EAAOiB,aAC3EH,GAAO,EAGPd,EAAOe,OAASf,EAAOgB,mBAAqB,KAC5CP,EAAQT,KAIZA,EAAOkB,QAAUL,EAEjB5B,EAAKkC,YAAYnB,MA7BrB,SAAmBf,EAAMe,GAEvB,OADAf,EAAKkC,YAAYnB,GACVQ,QAAQC,QAAQT,KAX8Bf,EA0CvD,SAAsBK,GACpB,IAAIU,EAASd,SAASkC,cAAc,UACpCpB,EAAOqB,QAAU/B,EAAQ+B,SAAW,QACpCrB,EAAOsB,KAAOhC,EAAQgC,MAAQ,kBAC9BtB,EAAOuB,QAAUjC,EAAQiC,MACzBvB,EAAON,GAAKJ,EAAQI,IAAMJ,EAAQC,IAClCS,EAAOE,OAAS,YAEZZ,EAAQC,MACVS,EAAOwB,IAAMlC,EAAQC,KAGnBD,EAAQoB,OACVV,EAAOU,KAAOpB,EAAQoB,MAGxB,OAAOV,EA1DoDyB,CAAanC,IAMxE,OAJIG,IAA6B,IAAlBH,EAAQN,QACrBA,EAAMS,GAAWmB,GAGZA,EAyET,OAAO,SAAcc,GACnB,OAAOA,aAAiBC,MACtBnB,QAAQoB,IAAIF,EAAMG,IAAIxC,IACtBA,EAAKqC,IAIXI,EAAOC,QAAUhD,IACjB+C,EAAOC,QAAQC,OAASjD","sourcesContent":["function createLoadJS() {\n  var cache = {};\n  var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n\n  function exec(options) {\n    if (typeof options === \"string\") {\n      options = {\n        url: options,\n        debug: false\n      };\n    }\n\n    var cacheId = options.id || options.url;\n    var cacheEntry = cache[cacheId];\n\n    if (cacheEntry) {\n      if (!!options.debug) {\n        console.log(\"load-js: cache hit\", cacheId);\n      }\n      return cacheEntry;\n    }\n    else if (options.allowExternal !== false) {\n      var el = getScriptById(options.id) || getScriptByUrl(options.url);\n\n      if (el) {\n        var promise = Promise.resolve(el);\n\n        if (cacheId) {\n          cache[cacheId] = promise;\n        }\n\n        return promise;\n      }\n    }\n\n    if (!options.url && !options.text) {\n      throw new Error(\"load-js: must provide a url or text to load\");\n    }\n\n    var pending = (options.url ? loadScript : runScript)(head, createScript(options));\n\n    if (cacheId && options.cache !== false) {\n      cache[cacheId] = pending;\n    }\n\n    return pending;\n  }\n\n  function runScript(head, script) {\n    head.appendChild(script);\n    return Promise.resolve(script);\n  }\n\n  function loadScript(head, script) {\n    return new Promise(function(resolve, reject) {\n      // Handle Script loading\n      var done = false;\n\n      // Attach handlers for all browsers.\n      //\n      // References:\n      // http://stackoverflow.com/questions/4845762/onload-handler-for-script-tag-in-internet-explorer\n      // http://stevesouders.com/efws/script-onload.php\n      // https://www.html5rocks.com/en/tutorials/speed/script-loading/\n      //\n      script.onload = script.onreadystatechange = function() {\n        if (!done && (!script.readyState || script.readyState === \"loaded\" || script.readyState === \"complete\")) {\n          done = true;\n\n          // Handle memory leak in IE\n          script.onload = script.onreadystatechange = null;\n          resolve(script);\n        }\n      };\n\n      script.onerror = reject;\n\n      head.appendChild(script);\n    });\n  }\n\n  function createScript(options) {\n    var script = document.createElement(\"script\");\n    script.charset = options.charset || \"utf-8\";\n    script.type = options.type || \"text/javascript\";\n    script.async = !!options.async;\n    script.id = options.id || options.url;\n    script.loadJS = \"watermark\";\n\n    if (options.url) {\n      script.src = options.url;\n    }\n\n    if (options.text) {\n      script.text = options.text;\n    }\n\n    return script;\n  }\n\n  function getScriptById(id) {\n    var script = id && document.getElementById(id);\n\n    if (script && script.loadJS !== \"watermark\") {\n      console.warn(\"load-js: duplicate script with id:\", id);\n      return script;\n    }\n  }\n\n  function getScriptByUrl(url) {\n    var script = url && document.querySelector(\"script[src='\" + url + \"']\");\n\n    if (script && script.loadJS !== \"watermark\") {\n      console.warn(\"load-js: duplicate script with url:\", url);\n      return script;\n    }\n  }\n\n  return function load(items) {\n    return items instanceof Array ?\n      Promise.all(items.map(exec)) :\n      exec(items);\n  }\n}\n\nmodule.exports = createLoadJS();\nmodule.exports.create = createLoadJS;\n"]}